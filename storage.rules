rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Regla generica para todo lo que este bajo 'obras/{workId}'
    match /obras/{workId}/{allPaths=**} {
       // Permitir lectura y escritura si el usuario esta autenticado.
       // IMPORTANTE: En un entorno de produccion real, deberiamos validar 
       // que el usuario sea el PROPIETARIO de la obra (usando firestore.get() si fuera posible en storage rules,
       // o manteniendo metadatos estrictos).
       // Por ahora, para que funcionen Avances y Archivos sin complicaciones de metadatos:
       allow read, write: if request.auth != null;
    }
  }
}